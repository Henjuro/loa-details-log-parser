import{a as F}from"./chunk-5Z7Z4ZIM.mjs";import"./chunk-3HWDMON2.mjs";import"./chunk-2I7XES37.mjs";import"./chunk-LNTMWDPX.mjs";import"./chunk-WSJANNVG.mjs";import"./chunk-6KMKD42J.mjs";import k from"dayjs";import{v4 as O}from"uuid";import m from"fs";import c from"path";import S from"dayjs/plugin/customParseFormat";k.extend(S);function M(e,o){try{let t=e.filename.slice(0,-4),n=t+".json",u=m.readFileSync(c.join(e.mainFolder,e.filename),"utf-8");if(!u)return o(null,"empty log");let a=new F(e.meterData,!1);e.splitOnPhaseTransition===!0&&(a.splitOnPhaseTransition=!0);let P=u.split(`
`).filter(r=>r!=null&&r!="");for(let r of P)a.parseLogLine(r);a.splitEncounter();let f=a.encounters;if(f.length>0){let r={encounters:[]};for(let i of f){let d=i.lastCombatPacket-i.fightStartedOn;if(d<=1e3)continue;let l={name:"",damageTaken:0,isPlayer:!1};for(let s of Object.values(i.entities))s.damageTaken>l.damageTaken&&(l={name:s.name,damageTaken:s.damageTaken,isPlayer:s.isPlayer});let g={duration:d,mostDamageTakenEntity:l},p=O(),y=`${t}_${p}_encounter.json`;r.encounters.push({encounterId:p,encounterFile:y,...g}),m.writeFileSync(c.join(e.parsedLogFolder,y),JSON.stringify({...i,...g},T))}return m.writeFileSync(c.join(e.parsedLogFolder,n),JSON.stringify(r)),o(null,"log parsed")}return o(null,"no encounters found")}catch(t){return o(t,"log parser error")}function T(t,n){return n instanceof Map?{dataType:"Map",value:Array.from(n.entries())}:n instanceof Set?{dataType:"Set",value:Array.from(n.values())}:n}}export{M as fileParserWorker};
